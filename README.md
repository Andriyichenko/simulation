# Simulation Project Overview

![C++](https://img.shields.io/badge/c++-%2300599C.svg?style=for-the-badge&logo=c%2B%2B&logoColor=white) ![Python](https://img.shields.io/badge/python-3670A0?style=for-the-badge&logo=python&logoColor=ffdd54) ![Jupyter Notebook](https://img.shields.io/badge/jupyter-%23FA0F00.svg?style=for-the-badge&logo=jupyter&logoColor=white) ![GitHub](https://img.shields.io/badge/github-%23121011.svg?style=for-the-badge&logo=github&logoColor=white)

This project contains various simulation schemes for stochastic processes, focusing on different **Test Functionals** and **Approximation Methods**.

Please refer to the page 58 ~66 of the paper [*High order polynomial regression approximation schemes in total variation for multidimensional diffusions*](https://www.overleaf.com/project/6801f9a43ca0501e11926ee2)

## Naming Convention

### C++ File Naming Convention
The file naming convention used throughout this project is as follows:

*   **`_check` suffix** (e.g., `LTM1_check`):
    *   Represents **self-verification** of a function or scheme.  
    *   These files are used to confirm the behavior of a single scheme or function in isolation.  

*   **No suffix** (e.g., `LTM1`):
    *   Represents the **Error** between schemes. 
    *   These files typically calculate the difference between two methods using a specific formula to analyze **Convergence** or **Error Rates**.

*   **`_limit` suffix** (e.g., `D1fM1_limit`):
    *   Represents the **direct calculation of the limit**. 
    *   These files focus solely on computing the limiting value.  

*   **`_all` suffix** (e.g., `D1fM1_all`):
    *   Represents a **combined analysis**. 
    *   These files integrate both the error analysis (difference) and limit calculations into a single executable.

*  **`_var` suffix** (e.g., `LTM1_check_var`):
   *  It indicates files simulated using specific values. For instance, `LTM1_check_var` corresponds to `LTM1_check ` with $x_0=1, T=1, z=0.5, a=-1, b=1,\alpha=1.5$. They are mainly used to generate Variance plots

### Data Source Naming Convention
The files in the `data_source/` directory follow a naming convention that links them to their generating C++ files and simulation parameters:

*   **`_100_1000_data` suffix**:
    *   Indicates that the dataset contains simulation results for a range of discretization points, specifically from $n=100$ to $n=1000$.

*   **File Prefix** (e.g., `D1fM1_check` in `D1fM1_check_100_1000_data.csv`):
    *   Corresponds directly to the name of the C++ file that generated the data (e.g., `D1fM1_check_100_1000_data.csv` is generated by `D1fM1_check.cpp`).
    *   This convention applies to all variations including `_limit`, `_all`, and `_var`, ensuring a clear mapping between the data and the code used to produce it.

---

## Simulation Modules

### 1. 2DLT Series
**Directory:** `2DLT/`

This module implements a test functional based on the **2D-Local Time** at a point $z$. It considers specific examples where:  

$$
\sigma(x) = \left( {s(x_2) \atop 0} \ \  {0 \atop s(x_1)} \right),\quad b(x) = \left( {s^{2}(x_2) \atop 0} \ \  {0 \atop s^{2}(x_1)} \right)
$$

Where,

$$
s(x) = 2 + \sin x, \quad a(x) = \left( {a_1(x) \atop a_2(x)}\right) = \left( {x_2 \atop -x_1}\right), \quad x_{\text{start}} = \left( {1 \atop 1}\right), \quad T = 1
$$

It implements various simulation schemes (Euler, Milstein, 1.5 order) for multidimensional processes.

Define discrete approximation of the local time at the point $z$ as

$$
L_n^z(X) = \sum_{k=1}^n \varphi_n(X_{t_{k,n}})h_n, \quad \varphi_n(x) = \sqrt{\frac{1}{2\pi h_n^\alpha}} e^{-\frac{(x-z)^2}{2h_n^\alpha}}, \quad \alpha \in (0, 2)
$$

We can use, for simplicity, a test functional based on the discrete approximation of the local time at the point $z$ for one component of the process

$$
F_n(\overline{X}) = f\left(L_n^z(\overline{X}^1)\right).
$$

$$
f(x) = \arctan(x)
$$

*   **Simulation Plot:** [2D_plot](./2D/2D_plot.ipynb)
*   **Simulation Code:** [2D](./2D/)

### 2. D1f Series
**Directory:** `D1f/`

This module simulates the **D1f series** based on the mathematical definition of 

$$
D_1(n, X)=\sum_{k=1}^n \Delta^1(h_n, X_{t_{k-1}}, X_{t_k}) - \frac{1}{2} \sum_{k=1}^n \left[ \Delta^1(h_n, X_{t_{k-1}}, X_{t_k}) \right]^2
$$

Where,

$$
\begin{aligned}
\Delta^1(t, x, y) &= \frac{1}{4}b'(x)b(x)t^2 H_t^3(x, y) \\
&= \frac{1}{2}\sigma'(x)\sigma(x)^3 t^2 \left( \frac{(y-x-a(x)t)^3}{\sigma(x)^6 t^3} - 3\frac{(y-x-a(x)t)}{\sigma(x)^4 t^2} \right) \\
&= \frac{1}{2}\sigma'(x) \left( \frac{(y-x-a(x)t)^3}{\sigma(x)^3 t} - 3\frac{(y-x-a(x)t)}{\sigma(x)} \right)
\end{aligned}
$$

The functional is defined using a bounding function $f(x) = (x \wedge 0) \vee (-100)$ to ensure stability:  

$$
\bar{F}^E_n(X) = f(D_1(n, X))
$$

where $D_1(n, X)$ involves first-order increments.  

In this case the limit of $\mathbb{E} [\bar{F}_n^E(X^{[n]}) - \bar{F}_n^E(X^{1,[n]})]$ is: 

$$
\mathbb{E} \left[ f \left( I_T^0 + \frac{1}{2}\langle I^0 \rangle_T \right) \left( 1 - \exp \left( -I_T^0 - \frac{1}{2}\langle I^0 \rangle_T \right) \right) \right] 
$$

Where

$$
I_T^0 = \int_0^T \sqrt{\frac{3}{2}} |\sigma'|(X(s)) dW_s^{(3)}.  
$$

*   **Simulation Plot:** [D1f_plot](./D1f/D1f_plot.ipynb)
*   **Simulation Code:** [D1f](./D1f/)

### 3. D1S Series (TV-distance Lower Bounds)
**Directory:** `D1S/`

This module focuses on test functionals for the lower bounds of the Total Variation (TV) distance.
It uses the sign function to define the functional:

$$
F_n^E(X) = \text{sgn}(D_1(n, X))
$$

Where,

$$
\begin{aligned}
\Delta^1(t, x, y) &= \frac{1}{4}b'(x)b(x)t^2 H_t^3(x, y) \\
&= \frac{1}{2}\sigma'(x)\sigma(x)^3 t^2 \left( \frac{(y-x-a(x)t)^3}{\sigma(x)^6 t^3} - 3\frac{(y-x-a(x)t)}{\sigma(x)^4 t^2} \right) \\
&= \frac{1}{2}\sigma'(x) \left( \frac{(y-x-a(x)t)^3}{\sigma(x)^3 t} - 3\frac{(y-x-a(x)t)}{\sigma(x)} \right)
\end{aligned}
$$

This is used to show numerically that approximation rates for Euler schemes are not better than $h_n^0$. 

The limit can also be computed explicitly

$$
\mathbf{E} \left| \exp \left( -I_T^0 - \frac{1}{2}\langle I^0 \rangle_T \right) - 1 \right| 
$$

Where,

$$
I_T^0 = \int_0^T \sqrt{\frac{3}{2}} |\sigma'|(X(s)) dW_s^{(3)}.
$$

*   **Simulation Plot:** [D1S_plot](./D1S/D1S_plot.ipynb)
*   **Simulation Code:** [D1S](./D1S/)

### 4. D2f Series
**Directory:** `D2f/`

Define the $D_2$ function: 

$$
D_2(n, X) = \sum_{k=1}^n \Delta^2(h_n, X_{t_{k-1}}, X_{t_k})
$$

Where,

$$
\begin{aligned}
\Delta_t^2(x, y) &= \left( \frac{1}{2}a'(x)b(x) + \frac{1}{4}b'(x)a(x) + \frac{1}{8}b''(x)b(x) - \frac{1}{16}b'(x)^2 \right) t^2 H_t^2(x, y) \\
&\quad + \frac{1}{12}b''(x)b(x)^2 t^3 H_t^4(x, y) \\
&= \left( \frac{1}{2}a'(x)\sigma(x)^2 + \frac{1}{2}\sigma'(x)a(x)\sigma(x) + \frac{1}{4}\sigma''(x)\sigma(x)^3 \right) t^2 \left( \frac{(y-x-a(x)t)^2}{\sigma(x)^4 t^2} - \frac{1}{\sigma(x)^2 t} \right) \\
&\quad + \frac{1}{6} \left( \sigma''(x)\sigma(x)^5 + (\sigma'(x))^2\sigma(x)^4 \right) t^3 \left( \frac{(y-x-a(x)t)^4}{\sigma(x)^8 t^4} - 6\frac{(y-x-a(x)t)^2}{\sigma(x)^6 t^3} + \frac{3}{\sigma(x)^4 t^2} \right) \\
&= \left( \frac{1}{2}a'(x)\sigma(x) + \frac{1}{2}\sigma'(x)a(x) + \frac{1}{4}\sigma''(x)\sigma(x)^2 \right) \left( \frac{(y-x-a(x)t)^2}{\sigma(x)^3} - \frac{t}{\sigma(x)} \right) \\
&\quad + \frac{1}{6} \left( \sigma''(x)\sigma(x) + (\sigma'(x))^2 \right) \left( \frac{(y-x-a(x)t)^4}{\sigma(x)^4 t} - 6\frac{(y-x-a(x)t)^2}{\sigma(x)^2} + 3t \right).
\end{aligned}
$$

There is no theoretical prediction for the behavior of $\mathbb{E} \left[F_n^M(X^{[n]}) - F_n^M(X^{0,[n]})\right]$, the theoretical bound here $O(n^{1/2})$, but what we have observed in the earlier simulations is that the rate is very close to $O(n^{-1})$. 

In this set-up one may also consider

$$
\textrm{E} \left[\bar{F}_n^M(X^{[n]}) - \bar{F}_n^M(X^{1,[n]})\right] \quad\cdots \text{(D2f)}
$$

Where

$$
\bar{F}_n^M(X^{[n]}) := h_n^{-1/2} f(\Delta_2(n, X)). 
$$

The limit is as before

$$
\mathbb{E} \left[ f \left(I_T^1\right) I_T^1 \right]. \quad\cdots \text{(D2f-limit)}
$$

In the case of the sign function this becomes $\mathbb{E}[|I_T^1|]$. 

*   **Simulation Plot:** [D2f_plot](./D2f/D2f_plot.ipynb)
*   **Simulation Code:** [D2f](./D2f/)

### 5. D2S Series
**Directory:** `D2S/`

Similar to D1S, this module defines test functionals for lower bounds of TV-distance but for higher-order terms.

$$
F_n^M(X) = h_n^{-1/2}\text{sgn}(D_2(n, X))
$$

where,

$$
\begin{aligned}
\Delta_t^2(x, y) &= \left( \frac{1}{2}a'(x)b(x) + \frac{1}{4}b'(x)a(x) + \frac{1}{8}b''(x)b(x) - \frac{1}{16}b'(x)^2 \right) t^2 H_t^2(x, y) \\
&\quad + \frac{1}{12}b''(x)b(x)^2 t^3 H_t^4(x, y) \\
&= \left( \frac{1}{2}a'(x)\sigma(x)^2 + \frac{1}{2}\sigma'(x)a(x)\sigma(x) + \frac{1}{4}\sigma''(x)\sigma(x)^3 \right) t^2 \left( \frac{(y-x-a(x)t)^2}{\sigma(x)^4 t^2} - \frac{1}{\sigma(x)^2 t} \right) \\
&\quad + \frac{1}{6} \left( \sigma''(x)\sigma(x)^5 + (\sigma'(x))^2\sigma(x)^4 \right) t^3 \left( \frac{(y-x-a(x)t)^4}{\sigma(x)^8 t^4} - 6\frac{(y-x-a(x)t)^2}{\sigma(x)^6 t^3} + \frac{3}{\sigma(x)^4 t^2} \right) \\
&= \left( \frac{1}{2}a'(x)\sigma(x) + \frac{1}{2}\sigma'(x)a(x) + \frac{1}{4}\sigma''(x)\sigma(x)^2 \right) \left( \frac{(y-x-a(x)t)^2}{\sigma(x)^3} - \frac{t}{\sigma(x)} \right) \\
&\quad + \frac{1}{6} \left( \sigma''(x)\sigma(x) + (\sigma'(x))^2 \right) \left( \frac{(y-x-a(x)t)^4}{\sigma(x)^4 t} - 6\frac{(y-x-a(x)t)^2}{\sigma(x)^2} + 3t \right).
\end{aligned}
$$

Similarly, we expect to observe that

$$
\begin{aligned}
\mathbb{E} \left[ F_n^M(X^{[n]}) - F_n^M(X^{1,[n]}) \right] &\approx \mathbf{E} \text{sgn} \left( \log \mathcal{E}_n^2(X^{0,[n]}) \right) (\mathcal{E}_n^2(X^{0,[n]}) - 1) \\
&\to \mathbf{E} \text{sgn}(\log(1 + I_T^1))(I_T^1)
\end{aligned}
$$

Where,

$$
I_T^1 = \sqrt{2} \int_0^T |c_2^2||b|^{-1}(X(s)) dW_s^{(2)} + \sqrt{4! } \int_0^T |c_4^2| b^{-2}(X(s)) dW_s^{(4)}
$$

$$
\begin{aligned}
c_4^2(x) &= \frac{1}{12}b''(x)b(x)^2 \\
c_2^2(x) &= \frac{1}{2}a'(x)b(x) + \frac{1}{4}b'(x)a(x) + \frac{1}{8}b''(x)b(x) - \frac{1}{16}b'(x)^2. 
\end{aligned}
$$

Furthermore,

$$
\mathbb{E} \left[F_n^M(X^{[n]}) - F_n^M(X^{2,[n]})\right] = O(n^{-1/2}).
$$

It is used to analyze the Milstein scheme's approximation rates. 

*   **Simulation Plot:** [D2S_plot](./D2S/D2S_plot.ipynb)
*   **Simulation Code:** [D2S](./D2S/)

### 6. Local Time (LT)
**Directory:** `LT/`

This module implements a test functional based on the **Local Time** at a point $z$. 

Define discrete approximation of the local time at the point $z$ as

$$
L_n^z(X) = \sum_{k=1}^n \varphi_n(X_{t_{k,n}})h_n, \quad \varphi_n(x) = \sqrt{\frac{1}{2\pi h_n^\alpha}} e^{-\frac{(x-z)^2}{2h_n^\alpha}}, \quad \alpha \in (0, 2)
$$

The test functional used is $F_n(\overline{X}^\theta) = \arctan(L_n^z(\overline{X}^\theta))$.

Particular choice:  $f(x) = \arctan(x)$. We will compare

$$
\mathbb{E}[F_n(\overline{X})] - \mathbb{E}[F_n(\overline{X}^\alpha)]
$$

*   **Simulation Plot:** [LT_plot](./LT/LT_plot.ipynb)
*   **Simulation Code:** [LT](./LT/)

### 7. Max Measure (MM)
**Directory:** `Max/`

This module measures errors using the **maximum measure** (strong convergence).
It compares different schemes (Euler, Milstein, 1.5) using:  

$$
\mathbb{E} \left[ \max_{i=1,\ldots,n} \|X_{t_{i,n}} - \bar{X}^\theta_{t_{i,n}}\|^2 \right]
$$

*   **Simulation Plot:** [MM_plot](./Max/MM_plot.ipynb)
*   **Simulation Code:** [Max](./Max/)
